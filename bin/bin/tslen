#!/usr/bin/env bash
# Description: <ADD>

# Record usage
logx "$(basename "$0")"

set -e # Exit on error
set -o pipefail # Exit on pipe error

# Add your VScode path here
directory_path="/Applications/Visual Studio Code.app"
new_length="$1"

if [ -z "$1" ]; then
  echo "No length supplied, will use default (160)"
  new_length=160
fi

file_path=$(find "$directory_path" -name "tsserver.js" 2>/dev/null)
if [ -z "$file_path" ]; then
  echo "tsserver.js file not found within directory $directory_path after recursive search"
  exit 1
fi

# echo "Found tsserver.js at \"$file_path\""

# Use awk to perform the replacement
awk -v new_length="$new_length" '{sub(/var defaultMaximumTruncationLength = [0-9]+;/, "var defaultMaximumTruncationLength = " new_length ";")}1' "$file_path" >temp_file && mv temp_file "$file_path"

echo "Length updated successfully: "
cat "$file_path" | grep "defaultMaximumTruncationLength = "