#!/usr/bin/env bash
# Description: Fuzzy find and run a package.json script with the correct package manager

set -e # Exit on error

# TODO - need to handle monorepos where the lockfile is in the root
if [[ -f pnpm-lock.yaml ]]; then
  packageManager="pnpm"
elif [[ -f pnpm-lock.json ]]; then
  packageManager="pnpm"
elif [[ -f package-lock.json ]]; then
  packageManager="npm"
elif [[ -f bun.lock ]]; then
  packageManager="bun"
elif [[ -f yarn.lock ]]; then
  packageManager="yarn"
fi

sc=$(cat package.json | jq '.scripts | keys[]' | tr -d '\"' | fzf)

if [[ $? = 0 ]]; then
  unifiedAddHistory "$packageManager run $sc"
  $packageManager run "$sc"
fi